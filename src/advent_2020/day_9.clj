(ns advent-2020.day-9
  (:require [clojure.string :as string]))


(defn decode
  [input]
  (mapv #(Long/parseLong %) (string/split-lines input)))


(defn part-1
  [input preamble-length]
  (let [nums (decode input)
        invalid-idx (->> (range preamble-length (count nums))
                         (remove
                           (fn [idx]
                             (some
                               (fn [[i j]]
                                 (= (get nums idx) (+ (get nums i) (get nums j))))
                               (for [i (range (- idx preamble-length) idx)
                                     j (range i idx)]
                                 [i j]))))
                         (first))]
    (get nums invalid-idx)))


(defn part-2
  [input num]
  (let [nums (decode input)
        sum-range (first (filter
                           #(= num (reduce + (map nums %)))
                           (for [i (range (count nums))
                                 j (range (+ 2 i) (count nums))]
                             (range i j))))
        sum-nums (map nums sum-range)]
    (+ (apply max sum-nums) (apply min sum-nums))))


(def small-input
  "35\n20\n15\n25\n47\n40\n62\n55\n65\n95\n102\n117\n150\n182\n127\n219\n299\n277\n309\n576")


(def large-input
  "21\n41\n40\n48\n6\n37\n31\n10\n50\n9\n44\n45\n36\n34\n13\n17\n32\n16\n8\n35\n30\n42\n29\n24\n11\n14\n83\n22\n15\n23\n18\n19\n20\n21\n91\n25\n33\n26\n27\n28\n38\n34\n31\n32\n45\n64\n30\n35\n29\n60\n36\n37\n47\n39\n67\n40\n51\n46\n48\n61\n52\n53\n54\n55\n63\n59\n75\n62\n65\n83\n76\n108\n91\n88\n104\n82\n77\n95\n106\n86\n127\n97\n114\n100\n171\n105\n113\n162\n130\n121\n124\n137\n233\n208\n201\n153\n159\n163\n287\n211\n188\n172\n290\n186\n183\n313\n197\n205\n267\n218\n266\n261\n430\n245\n258\n323\n398\n331\n312\n335\n316\n573\n471\n355\n450\n455\n417\n401\n463\n380\n402\n415\n423\n721\n476\n503\n625\n557\n628\n1027\n639\n643\n647\n715\n816\n778\n735\n770\n757\n781\n782\n795\n803\n817\n825\n838\n891\n899\n979\n1131\n1060\n1185\n1196\n1267\n1358\n1282\n1492\n1362\n2012\n1505\n1641\n1516\n1694\n1737\n1599\n1612\n1598\n1898\n1790\n1663\n2076\n2407\n1878\n2866\n2191\n2672\n2381\n2629\n3336\n2798\n4270\n3743\n2867\n3146\n3668\n3262\n4464\n3197\n4284\n3261\n5744\n5160\n4044\n4999\n3541\n7545\n4285\n8026\n4989\n6203\n5010\n6842\n5826\n5665\n5944\n6013\n7209\n10886\n11494\n6459\n6458\n6802\n6738\n7305\n10159\n7585\n7826\n9485\n8530\n8551\n9274\n12471\n9999\n12285\n11213\n10675\n18111\n18743\n12402\n19611\n12472\n14988\n12917\n17311\n13260\n13196\n18036\n28017\n14890\n16115\n15411\n16356\n19764\n20487\n17825\n20674\n28758\n21212\n21888\n23077\n25663\n29616\n27362\n24874\n25389\n25668\n40377\n28671\n50439\n26456\n28607\n30301\n36085\n31005\n31526\n43493\n59059\n37589\n38312\n39037\n42562\n43100\n48574\n44965\n73963\n50263\n70354\n68367\n57461\n51057\n52124\n55063\n55127\n66386\n59612\n73401\n82425\n62531\n108186\n69115\n75901\n77349\n158449\n80874\n81599\n147703\n88065\n93539\n100092\n101320\n118510\n103181\n131646\n106120\n106184\n107187\n122143\n128528\n155000\n133013\n135932\n179082\n138432\n145016\n182085\n235874\n158223\n182919\n162473\n181691\n181604\n194859\n199659\n221691\n302046\n237766\n209301\n250671\n213307\n341835\n268945\n255156\n261541\n271445\n324098\n274364\n283448\n296655\n339914\n491514\n320696\n339827\n344077\n713205\n539486\n376463\n394518\n408960\n459457\n478246\n422608\n496755\n463978\n468463\n516697\n526601\n611272\n544989\n545809\n614278\n557812\n840832\n734345\n812210\n1191451\n660523\n1009787\n1017732\n921452\n1418207\n770981\n932441\n1083131\n882065\n946709\n886586\n1563541\n1013452\n995064\n1084413\n1554776\n1090798\n1427874\n1103621\n1881650\n1218335\n2059167\n1698796\n1592964\n1431504\n1547109\n1653046\n1657567\n1692433\n3613943\n1703422\n2515917\n1768651\n1828774\n2539632\n3734252\n2008516\n2079477\n2085862\n4308283\n3967512\n2194419\n2321956\n2535125\n2649839\n2765444\n3204676\n2978613\n3024468\n3315760\n5855392\n3854513\n3350000\n3395855\n3472073\n5717811\n3837290\n3597425\n3908251\n4087993\n4330472\n5087400\n4165339\n4280281\n4516375\n4729544\n4844258\n4857081\n5885125\n5415283\n5744057\n6711615\n6913185\n6340228\n6665760\n6745855\n8637795\n7069498\n12550885\n7745541\n7925283\n7927897\n7505676\n7996244\n11602936\n8445620\n9909396\n8681714\n9124539\n9245919\n10473601\n9701339\n10272364\n16373517\n17762334\n12084285\n18516121\n13086083\n14268125\n13411615\n18197647\n14575174\n16194037\n15251217\n18200261\n21304275\n15433573\n32337508\n16677958\n24177521\n17127334\n17806253\n17927633\n18370458\n18947258\n53641783\n28662832\n25523581\n25170368\n25495900\n27517858\n35194079\n26497698\n30538949\n34875605\n41689937\n29826391\n30684790\n31929175\n33239826\n37982233\n32111531\n35048416\n34484211\n34933587\n53564537\n35733886\n53833200\n37317716\n62711937\n51019481\n51993598\n52688226\n61755566\n56324089\n54015556\n82948656\n65733206\n60365340\n60511181\n61937922\n62613965\n64040706\n65169001\n86477809\n90670459\n118733538\n70667473\n69417798\n118262011\n87727484\n73051602\n88337197\n89311314\n118079655\n103013079\n104681824\n123355699\n118056262\n120876521\n124551887\n127782966\n135151004\n148238665\n129209707\n166619746\n153352020\n133458504\n154480315\n140085271\n142469400\n143719075\n228422468\n157145282\n177038798\n264637158\n162362916\n272928782\n193993138\n207694903\n247151224\n222738086\n238932783\n242608149\n245428408\n390785384\n360612884\n262668211\n419646947\n269294978\n493059626\n282554671\n273543775\n384733701\n351138420\n371031936\n300864357\n461670869\n319508198\n582009863\n356356054\n588803176\n401688041\n416731224\n430432989\n603507278\n481540932\n536211986\n488036557\n629899829\n531963189\n542838753\n545222882\n551849649\n556098446\n574408132\n658277476\n593051973\n949707426\n620372555\n657220411\n675864252\n1058908452\n721196239\n832121030\n1081088530\n818419265\n847164213\n1017752918\n1172738582\n1024248543\n1570079981\n731031916\n1152335744\n1871412756\n1074801942\n1475639676\n1097072531\n1126257781\n1268916225\n1194780687\n1388252327\n1213424528\n1296236807\n1578196129\n1333084663\n2064116579\n1539615504\n3045719657\n1549451181\n1665583478\n1748784834\n1755280459\n2280483097\n2482340753\n3634196560\n3213372669\n1805833858\n2646523712\n2463054269\n4801000116\n2934499703\n2601676855\n2583033014\n2937703508\n3298236015\n5761290284\n4031791934\n3045021641\n4195974893\n3089066685\n3205198982\n3215034659\n4754650163\n4086316955\n3414368312\n5668253251\n3561114317\n4268888127\n7846021757\n4388866872\n4407510713\n4452357570\n5046087283\n12253532470\n5184709869\n5517532717\n5520736522\n8818972537\n9800737446\n8841224442\n7285041578\n6606135958\n6134088326\n6503434997\n8676398840\n6629402971\n6776148976\n6975482629\n11013646671\n7949981189\n7830002444\n11183659689\n8657754999\n13293582012\n8796377585\n9453597996\n9498444853\n10230797152\n18174843693\n12126872480\n11038269239\n14453416186\n12637523323\n15942796577\n13419129904\n12910237302\n12740224284\n16506401284\n13751631605\n13405551947\n14579384160\n16626380029\n14805485073\n15779983633\n22283418630\n22193822280\n19027174737\n23948506541\n18249975581\n18952042849\n32449197861\n36035050235\n21269066391\n34894839426\n23165141719\n23675792562\n25377747607\n41157731240\n25650461586\n26159354188\n32286384917\n26145776231\n29531615238\n27157183552\n27984936107\n29384869233\n37979217586\n53333375774\n76498517493\n55035330819\n55544223421\n37202018430\n64426454664\n39519041972\n111393356919\n44944858953\n94554372791\n44434208110\n46840934281\n52696756957\n51523523838\n51796237817\n51809815774\n80685792405\n52305130419\n53302959783\n54130712338\n58916484471\n55142119659\n67364086819\n66586887663\n75181236016\n76721060402\n81636226540\n82146877383\n83953250082\n84042952711\n105926950155\n84463900925\n89379067063\n96741096770\n95957731948\n105112775557\n104114946193\n201853872327\n107447250078\n108445079442\n212560025635\n105608090202\n113047196809\n196826317141\n109272831997\n114058604130\n121729007322\n133950974482\n286317773252\n177593958488\n158357286942\n192398329524\n202349186972\n167996202793\n193494013256\n195306017218\n194987157265\n185336799011\n390293174483\n200072678141\n481623790470\n209723036395\n213055340280\n214053169644\n214880922199\n218655287011\n282054806923\n227105800939\n615574764952\n223331436127\n235787611452\n326353489735\n292308261424\n335951245430\n350755616466\n343694085953\n353333001804\n404710193660\n380323956276\n378830812267\n380642816229\n385409477152\n395059835406\n545008776746\n409795714536\n422778376675\n436386776407\n427936262479\n445761087950\n433536209210\n441986723138\n632810423389\n951526010382\n925118684813\n459119047579\n528095872876\n618661751159\n817029592636\n736165093618\n724336902182\n812367021477\n733975818033\n759154768543\n1353054947292\n788626526803\n766052293381\n1361505461220\n804855549942\n832574091211\n837731977015\n1060746685868\n861472471689\n875522932348\n879297297160\n1713745211616\n1201141491681\n1193094865612\n1195284141197\n987214920455\n1077780798738\n1740769768849\n1352637569192\n1593482076745\n1458312720215\n1483491670725\n1595448289722\n1667923823963\n1670306068226\n3224261439574\n1627524765070\n2941804390940\n1848687392144\n1637429641153\n1694046562900\n1699204448704\n1866512217615\n2657520988681\n1754820229508\n2445527640670\n2064995719193\n2273064939935\n2180309786067\n2182499061652\n3258090584805\n3732919543156\n2810950289407\n3078939960447\n3152359283115\n3177538233625\n3111016435795\n3222973054792\n3565716666319\n4781322504021\n3621332447123\n5468471278088\n4455564001587\n3331476204053\n3759042282093\n3393251011604\n3454024678212\n3819815948701\n4991260075474\n4510523359863\n4245305505260\n5405472116444\n4362808847719\n4993449351059\n5261439022099\n7321473649270\n5889890249854\n6256478194072\n9026804563567\n6263375718910\n6288554669420\n12312733724744\n9221366453907\n6785500882265\n6724727215657\n7441148395824\n6847275689816\n9710502872284\n7699330183472\n9656626730514\n12690590258946\n8445284753686\n10501783699332\n8608114352979\n13211363899124\n9238754856319\n10626184566629\n12614617465511\n10254888373158\n11517917216171\n13135830359236\n12146368443926\n19963201969857\n12551930388330\n13074055551685\n13013281885077\n13510228097922\n13572002905473\n23178114954959\n14165875611481\n15292560443502\n19234298919608\n23639466451706\n16144614937158\n20997215142016\n17053399106665\n17684039610005\n17846869209298\n18863002726137\n24698298832256\n21385123300245\n36775296810942\n41323506061711\n23765116471080\n23664285660097\n33139429652800\n25159650329003\n42843689939008\n25565212273407\n32976600053507\n26523509982999\n27082231003395\n27737878516954\n29458436054983\n33028878337618\n31437175380660\n33991484146456\n39069162910250\n54361723353752\n34737438716670\n34900268315963\n44929100212693\n36709871935435\n93430886264002\n61982499319358\n55023648328390\n62638146832917\n47429402131177\n52647443276802\n51683160312002\n50724862602410\n60302650990077\n52088722256406\n53605740986394\n65592672893249\n54261388499953\n56540667058378\n57196314571937\n60895611435643\n64466053718278\n116317535495659\n118727442218231\n86988990572369\n69637707032633\n107732053121254\n71610140251398\n98692371254793\n84139274066612\n104330603588804\n98154264733587\n124661355361023\n99112562443179\n141250379072322\n102408022914412")
