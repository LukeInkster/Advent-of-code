(ns advent-2020.day-20
  (:require [clojure.string :as string]
            [common.util :refer :all]))


(defn read-tile
  [tile-str]
  (let [[id-str & grid] (string/split-lines tile-str)]
    [(Long/parseLong (re-find #"[0-9]+" id-str)) (mapv vec grid)]))


(defn read-tiles
  [input]
  (into {} (map read-tile) (string/split input #"\n\n")))


(defn sides
  "Returns the sides of a tile in the order [top right bottom left]"
  [tile]
  [(first tile) (mapv peek tile) (vec (reverse (peek tile))) (mapv first (reverse tile))])


(defn matches-required-sides-fn
  [side-id->flipped-side-id sides-grid i j]
  (let [required-sides
        ;; from top clockwise, the required sides must be the flips of...
        (->> [(get (get-in sides-grid [(dec i) j]) 2)       ;; the bottom of tile above
              (get (get-in sides-grid [i (inc j)]) 3)       ;; the left of tile to the right
              (get (get-in sides-grid [(inc i) j]) 0)       ;; the top of tile below
              (get (get-in sides-grid [i (dec j)]) 1)]      ;; the right of the tile to the left
             (mapv side-id->flipped-side-id))]
    (fn [sides]
      (every? (fn [[side required-side]] (or (nil? required-side) (= required-side side)))
              (zipmap sides required-sides)))))


(defn sides->possible-sides
  "Returns a vector of vectors of all the sides this piece could have after flipping and rotating"
  [side-id->flipped-side-id side-ids]
  (let [reversed-side-ids (map side-id->flipped-side-id (reverse side-ids))]
    (vec (concat
           (for [i (range 4)] [i (vec (concat (drop i side-ids) (take i side-ids)))])
           (for [i (range 4)] [(+ i 4) (vec (concat (drop i reversed-side-ids) (take i reversed-side-ids)))])))))


(defn recursive-solve
  [side-id->flipped-side-id remaining-tile-id->possible-side-ids ids-grid sides-grid orientations-grid i j]
  (if (= i (count ids-grid))
    [ids-grid orientations-grid]
    (let [matches-required-sides? (matches-required-sides-fn side-id->flipped-side-id sides-grid i j)
          possible-tile-placements (remove (comp empty? val)
                                           (mapm (fn [possible-side-ids]
                                                   (filter (comp matches-required-sides? second) possible-side-ids))
                                                 remaining-tile-id->possible-side-ids))]
      (let [[next-i next-j] (if (= j (dec (count (first ids-grid)))) [(inc i) 0] [i (inc j)])]
        (->> (for [[tile-id placements] possible-tile-placements
                   [orientation sides] placements]
               (recursive-solve
                 side-id->flipped-side-id
                 (dissoc remaining-tile-id->possible-side-ids tile-id)
                 (assoc-in ids-grid [i j] tile-id)
                 (assoc-in sides-grid [i j] sides)
                 (assoc-in orientations-grid [i j] orientation)
                 next-i
                 next-j))
             (remove empty?)
             (first))))))


(defn solve
  [tile-id->tile]
  (let [tile-id->sides (mapm sides tile-id->tile)
        side->side-id (into {}
                            (map-indexed (fn [idx side] [side idx]))
                            (distinct (concat (mapcat val tile-id->sides)
                                              (map reverse (mapcat val tile-id->sides)))))
        side-id->flipped-side-id (into {}
                                       (keep (fn [[side side-id]]
                                               (when (contains? side->side-id (reverse side))
                                                 [side-id (get side->side-id (reverse side))])))
                                       side->side-id)
        tile-id->base-side-ids (mapm #(mapv side->side-id %) tile-id->sides)
        tile-id->possible-side-ids (mapm (partial sides->possible-sides side-id->flipped-side-id) tile-id->base-side-ids)
        grid-size (long (Math/sqrt (count tile-id->tile)))
        initial-grid (vec (repeat grid-size (vec (repeat grid-size nil))))]
    (recursive-solve side-id->flipped-side-id tile-id->possible-side-ids initial-grid initial-grid initial-grid 0 0)))


(defn part-1
  [input]
  (let [tiles (read-tiles input)
        [ids] (solve tiles)
        end-idx (dec (count (first ids)))]
    (* (get-in ids [0 0])
       (get-in ids [0 end-idx])
       (get-in ids [end-idx 0])
       (get-in ids [end-idx end-idx]))))


(defn remove-border
  [[id tile]]
  [id (mapv (fn [row] (vec (rest (butlast row)))) (rest (butlast tile)))])


(defn rotate
  [tile]
  (let [length (count tile)]
    (vec (for [i (range length)]
           (vec (for [j (range length)]
                  (get-in tile [j (- length i 1)])))))))


(defn orient
  [tile orientation]
  (let [flipped? (<= 4 orientation)
        rotations (mod orientation 4)
        tile (if flipped?
               (vec (for [i (range (count tile))]
                      (mapv (fn [row] (nth row i)) tile)))
               tile)]
    (nth (iterate rotate tile) rotations)))


(def monster
  (mapv vec (string/split-lines "                  # \n#    ##    ##    ###\n #  #  #  #  #  #   ")))


(def monster-hash-count (count (filter #{\#} (flatten monster))))


(defn contains-monster?
  [sub-image]
  (every? true? (for [i (range (count monster))
                      j (range (count (nth monster i)))]
                  (or (not= \# (get-in monster [i j]))
                      (= \# (get-in sub-image [i j]))))))


(defn count-monsters
  [image]
  (let [image-height (count image)
        image-width (count (first image))
        monster-height (count monster)
        monster-width (count (first monster))]
    (count (filter true? (for [start-i (range (inc (- image-height monster-height)))
                               start-j (range (inc (- image-width monster-width)))]
                           (let [rows (take monster-height (drop start-i image))
                                 grid (mapv (fn [row] (vec (take monster-width (drop start-j row)))) rows)]
                             (contains-monster? grid)))))))


(defn part-2
  [input]
  (let [tiles (read-tiles input)
        [ids orientations] (solve tiles)
        id->orientation (into {} (map (fn [id orientation] [id orientation]) (flatten ids) (flatten orientations)))
        stripped-tiles (mapv remove-border tiles)
        id->oriented-tile (into {} (map (fn [[id tile]] [id (orient tile (id->orientation id))]) stripped-tiles))
        image (mapv vec (mapcat (fn [id-row]
                                  (let [row-tiles (map id->oriented-tile id-row)]
                                    (apply (partial mapv concat) row-tiles)))
                                ids))
        possible-images (mapv (fn [orientation] (orient image orientation)) (range 8))
        image-hash-count (count (filter #{\#} (flatten (first possible-images))))
        hash-counts (map (fn [image] (- image-hash-count (* monster-hash-count (count-monsters image)))) possible-images)]
    (apply min hash-counts)))


(def very-small-input
  "Tile 1:\n#.##...##.\n#.####...#\n.....#..##\n#...######\n.##.#....#\n.###.#####\n###.##.##.\n.###....#.\n..#.#..#.#\n#...##.#..\n\nTile 3:\n...#.#.#.#\n####.#....\n..#.#.....\n....#..#.#\n.##..##.#.\n.#.####...\n####.#.#..\n##.####...\n##..#.##..\n#.##...##.\n\nTile 4:\n###.##.#..\n.#..#.##..\n.#.##.#..#\n#.#.#.##.#\n....#...##\n...##..##.\n...#.#####\n.#.####.#.\n..#..###.#\n..##.#..#.\n\nTile 2:\n..##.#..#.\n##..#.....\n#...##..#.\n####.#...#\n##.##.###.\n##...#.###\n.#.#.#..##\n..#....#..\n###...#.#.\n..###..###")


(def small-input
  "Tile 2311:\n..##.#..#.\n##..#.....\n#...##..#.\n####.#...#\n##.##.###.\n##...#.###\n.#.#.#..##\n..#....#..\n###...#.#.\n..###..###\n\nTile 1951:\n#.##...##.\n#.####...#\n.....#..##\n#...######\n.##.#....#\n.###.#####\n###.##.##.\n.###....#.\n..#.#..#.#\n#...##.#..\n\nTile 1171:\n####...##.\n#..##.#..#\n##.#..#.#.\n.###.####.\n..###.####\n.##....##.\n.#...####.\n#.##.####.\n####..#...\n.....##...\n\nTile 1427:\n###.##.#..\n.#..#.##..\n.#.##.#..#\n#.#.#.##.#\n....#...##\n...##..##.\n...#.#####\n.#.####.#.\n..#..###.#\n..##.#..#.\n\nTile 1489:\n##.#.#....\n..##...#..\n.##..##...\n..#...#...\n#####...#.\n#..#.#.#.#\n...#.#.#..\n##.#...##.\n..##.##.##\n###.##.#..\n\nTile 2473:\n#....####.\n#..#.##...\n#.##..#...\n######.#.#\n.#...#.#.#\n.#########\n.###.#..#.\n########.#\n##...##.#.\n..###.#.#.\n\nTile 2971:\n..#.#....#\n#...###...\n#.#.###...\n##.##..#..\n.#####..##\n.#..####.#\n#..#.#..#.\n..####.###\n..#.#.###.\n...#.#.#.#\n\nTile 2729:\n...#.#.#.#\n####.#....\n..#.#.....\n....#..#.#\n.##..##.#.\n.#.####...\n####.#.#..\n##.####...\n##..#.##..\n#.##...##.\n\nTile 3079:\n#.#.#####.\n.#..######\n..#.......\n######....\n####.#..#.\n.#...#.##.\n#.#####.##\n..#.###...\n..#.......\n..#.###...")


(def large-input
  "Tile 3571:\n##..##....\n..##..#..#\n#...##....\n.....#...#\n..........\n...###....\n#......##.\n#...#...#.\n#...##...#\n#.####.##.\n\nTile 2687:\n#..##..###\n..........\n.....##..#\n.#.#..##.#\n#.#..#..##\n#.....#...\n#...#.....\n##....##..\n#...#...##\n..#.#.#.##\n\nTile 3049:\n##.#.#.###\n....##.###\n....##....\n#.........\n#.#...#..#\n#..##....#\n#.#......#\n#..#..##..\n#......###\n#.#..#...#\n\nTile 1597:\n###..##...\n##.....###\n.#..#..#.#\n#.......#.\n#.#.......\n.#..#.....\n#.....#...\n#........#\n##.#...##.\n.....#.###\n\nTile 1301:\n#.##.#.###\n#........#\n....#.....\n#.....####\n.#....#.##\n.....#....\n#..##..#.#\n.....#..##\n.#.##..#.#\n#...######\n\nTile 3259:\n..#####.#.\n.....#...#\n#...#.....\n...##...#.\n.#..#..##.\n.#.......#\n........##\n#.......#.\n.#.#...#..\n#...#.#..#\n\nTile 3989:\n#..#..####\n..........\n#........#\n.#....#...\n..........\n#.........\n.#........\n#........#\n...##.####\n.######.##\n\nTile 3803:\n#.####...#\n.###.#..#.\n....##..#.\n#........#\n..##..#...\n####.#....\n..#...#...\n#..#.....#\n..##....#.\n#....#...#\n\nTile 2897:\n.#..##.#.#\n..#.#...##\n#........#\n###.#..#.#\n...#..#.##\n...#....##\n....##...#\n.....##..#\n.#....#...\n..##....##\n\nTile 2843:\n##.###..##\n#.#.......\n#....#....\n#..##.##..\n.##..#.##.\n#....#....\n#.#...#.##\n..........\n.#...#...#\n###..#..##\n\nTile 3023:\n.#..###.#.\n.........#\n..........\n.#........\n#.#....#.#\n....#...#.\n#.......#.\n##.#.....#\n..#...#..#\n.....####.\n\nTile 2887:\n#....##...\n#...#.....\n##...##...\n#.....##.#\n.......#..\n#......#.#\n..##..#..#\n....#....#\n#.###.....\n#.####..#.\n\nTile 1013:\n#..####.#.\n#.##...#.#\n#..#..#...\n#..#..#..#\n...#......\n#.####...#\n.#..##..##\n...#.#..##\n....##..##\n#.##.#.#.#\n\nTile 3733:\n###.##.#.#\n..#....#..\n#...#.#..#\n....###..#\n.#........\n.....#....\n........##\n##........\n#........#\n#.#...#..#\n\nTile 3691:\n.##...####\n##..##....\n#.#.##..##\n#........#\n#.....##.#\n.....#....\n##.#.....#\n#..#.....#\n..#.......\n####....#.\n\nTile 3061:\n##.....#..\n.....#...#\n....##...#\n###.#.....\n#..#..###.\n#.#.###..#\n..#......#\n#..#.#...#\n..#.......\n..#.#..#..\n\nTile 1489:\n###.......\n.....##...\n..#...##..\n#.....#...\n#.#......#\n##.#..####\n...##.#...\n...#...#.#\n..........\n.##.##.#.#\n\nTile 1637:\n#########.\n.#.....#..\n#........#\n#........#\n.##.....##\n.........#\n#....#..##\n#.....####\n...###...#\n.#..##..##\n\nTile 1069:\n#.#...####\n##...#...#\n.....#...#\n.......##.\n......#..#\n#........#\n#...#.....\n......#...\n#.#..#....\n####.##.#.\n\nTile 1039:\n#..#######\n###.......\n.....#....\n#.........\n....#....#\n...####...\n.#...##...\n#.#....#.#\n........##\n#.#..#..#.\n\nTile 2767:\n.#.#..#.##\n.#..#....#\n#..#.#....\n#.#..##..#\n.####.#.##\n#....##...\n....##..##\n###.....#.\n..........\n....#.###.\n\nTile 2957:\n####.#####\n.......##.\n...#.....#\n...##..##.\n...##.##..\n#..#..#..#\n.....#....\n#..#....#.\n.##.......\n.##..#.##.\n\nTile 2789:\n.##..#.#.#\n#.#.....##\n#....#...#\n#....##...\n..#..#....\n#.........\n#.#..#..##\n#........#\n.#.......#\n#####...##\n\nTile 2837:\n.....#...#\n.....#.#.#\n#.......#.\n#...#...#.\n..#.....#.\n..#.#..#..\n##.......#\n....#....#\n#...#.....\n##.###....\n\nTile 3251:\n.######...\n...#......\n.#.#..###.\n#..#.##..#\n###.#....#\n#.#......#\n..#..###..\n##.#..#..#\n...#...###\n##.#..##..\n\nTile 3137:\n#####.#..#\n#.#..#.##.\n#.#..#....\n#.........\n.........#\n.........#\n...#......\n#...#...#.\n....#..#.#\n.#.###.#.#\n\nTile 3433:\n.##..####.\n...#......\n#..##....#\n....#....#\n#..###....\n..#......#\n.#..###...\n.##.#.....\n.........#\n.....#....\n\nTile 2551:\n#.########\n#.#.......\n##..#...##\n#.#..###.#\n#........#\n.#.#....#.\n#........#\n.##....#..\n#........#\n##..##.#..\n\nTile 2647:\n..####..##\n##....#..#\n#.........\n###.#.....\n#......#..\n....#...##\n.#..##.#.#\n.#.#..#...\n.....##.##\n.#.#...#..\n\nTile 1087:\n#..###..##\n#...#.#.#.\n.......#..\n..#.#.#..#\n#.......#.\n#....#....\n....#....#\n##...##..#\n#..#......\n.#..#.###.\n\nTile 1423:\n..#....#.#\n#........#\n.#.##.##..\n#.###.#.#.\n#.#......#\n...##...##\n#....#....\n....#....#\n.........#\n#####....#\n\nTile 1759:\n..#.#..#..\n##...#...#\n....#..#..\n#....#....\n.##..##..#\n...#.#...#\n#..#.....#\n##.......#\n......#..#\n#.##......\n\nTile 1583:\n.###.####.\n......###.\n......#..#\n.#...##...\n#...#....#\n..#.##....\n#...##..#.\n......#...\n#.....###.\n####.#....\n\nTile 1171:\n###......#\n#...##...#\n#####..##.\n#.......#.\n#.#...#..#\n#....#....\n....#....#\n##.....#.#\n#.#..#..##\n#.#.#..##.\n\nTile 2801:\n.###.####.\n......#...\n##..##.#.#\n.....#....\n#......#..\n###..##..#\n##.#..##.#\n#..#..#...\n#..#.#...#\n#..###.###\n\nTile 1559:\n.##..#...#\n#.##..#...\n...##..#..\n..#.#.....\n...#...#..\n.........#\n...#.....#\n#..##.#..#\n##..##....\n...###...#\n\nTile 2609:\n##.#..####\n..........\n#........#\n##.###...#\n#.#..#....\n..#..##..#\n#....#.#.#\n#.#.......\n#....#...#\n#.####.#.#\n\nTile 2287:\n#......#.#\n.....#.#.#\n..#..#...#\n##.#..#...\n..#..#.###\n.......###\n#......##.\n#.##.##...\n......#..#\n#####.##.#\n\nTile 3659:\n.###.#####\n#.#.......\n..........\n..#.....##\n#..#......\n#.#.#...##\n#.........\n.#...#....\n##.....#..\n#####.##.#\n\nTile 3539:\n.......#.#\n..##...#..\n.....#.#.#\n##.#......\n####......\n...#..#...\n#.......##\n#...#.....\n#..#.....#\n.##.#....#\n\nTile 3121:\n..##.#...#\n.###..#...\n##.#.#....\n#.....#..#\n#.#.......\n#.........\n....#...##\n......###.\n#........#\n#..###..##\n\nTile 2237:\n...##.....\n..........\n...#......\n#....#...#\n#.........\n.......#..\n#...###..#\n.....#...#\n.........#\n#.####.##.\n\nTile 1277:\n.###...##.\n.......###\n#.....##..\n#.##..###.\n#.#..#....\n.....#....\n#...#....#\n#.#......#\n#...###..#\n...##...##\n\nTile 2161:\n..#####..#\n#....##..#\n#.....#..#\n....#....#\n.....#.##.\n..........\n#......#.#\n#..#......\n#....#..##\n.##.....#.\n\nTile 3709:\n.#..#...##\n#..#.....#\n...#....#.\n..........\n.#...#....\n..........\n....##....\n#.........\n.........#\n..####....\n\nTile 1117:\n##.##.#..#\n.....##...\n.#.#..#.##\n.#...#..#.\n#.##.#....\n####.....#\n##..#.....\n#.........\n#...##...#\n####..#.#.\n\nTile 2081:\n##.##.###.\n#...#.....\n#.....#...\n#.#..#.#..\n#.....#..#\n...#.....#\n#....#....\n......#..#\n.#.##..#..\n###..#.#.#\n\nTile 1709:\n##...#.##.\n###..#....\n#.......#.\n#.....##..\n.........#\n#....#..##\n..#...##..\n#...#.....\n#...#.#..#\n.###.#....\n\nTile 2927:\n...###..##\n##.#......\n..........\n##........\n#....#...#\n.......##.\n#.....#..#\n##.#.#....\n#......#..\n...#.####.\n\nTile 1499:\n#....##.#.\n......#...\n#........#\n......#...\n.#.......#\n#.#...#.##\n..#....#.#\n#...#.....\n.........#\n#.....##.#\n\nTile 1453:\n#.##.####.\n..#...##..\n.........#\n.........#\n#..#..#...\n.........#\n#....#.#..\n#.....#..#\n.#........\n#....#....\n\nTile 1283:\n.#.##..###\n..#...#.#.\n...##..#..\n#.......#.\n#......#..\n#..##.....\n#.......##\n....##...#\n..#.....##\n##.#.#...#\n\nTile 2063:\n......#.##\n.........#\n....##..#.\n.#....##..\n##........\n.###.###.#\n#.#....#..\n....#...#.\n#......###\n#....####.\n\nTile 3529:\n...###.##.\n#....#...#\n...#.....#\n...#.#..#.\n.#.#.....#\n#...#.....\n##..#..#..\n#.....#..#\n.#........\n.#..#####.\n\nTile 2657:\n..#.##..#.\n##..#...##\n#.....#...\n#....##...\n.....#..##\n#.#..##.##\n#.........\n#.#...##.#\n##....#...\n##..####.#\n\nTile 2089:\n.#########\n##.#.##..#\n#........#\n#..###..##\n...#......\n##..#....#\n#...#..#..\n#..#....#.\n..#.#....#\n...###...#\n\nTile 3779:\n#.#...##.#\n.##...##..\n.....##...\n.#....##.#\n###..##..#\n#.#..#.#..\n....##...#\n##...#....\n.#...#....\n#######...\n\nTile 3217:\n...##.....\n....##....\n.....##..#\n##...#.#.#\n###.......\n...#...#..\n...#.....#\n#..#.#.###\n##.#...#.#\n.#.#..##..\n\nTile 3907:\n..#..##.##\n#.#.....##\n#.......#.\n.#...###..\n..###.####\n##.#..##..\n#.........\n##...#..#.\n#....#....\n.#.....#.#\n\nTile 3547:\n#..#.##...\n#..###...#\n##.......#\n.....#....\n#...#...#.\n#..#..#...\n........#.\n......##.#\n.......#..\n.##.#..##.\n\nTile 3187:\n##.#.##...\n#...#.##.#\n#...#.....\n#....#..##\n....#.#..#\n.....#....\n.....#..##\n....##...#\n..........\n#######.##\n\nTile 1217:\n##.#####..\n#.......#.\n...#....##\n#........#\n#.#......#\n.....#...#\n#.........\n....#...##\n#...#.....\n.#...###.#\n\nTile 3821:\n#.###.###.\n#.#......#\n#..#.#...#\n.##...#.##\n...#....##\n#...#..##.\n#......#.#\n###..#...#\n.........#\n#....##.##\n\nTile 1607:\n##..#..##.\n#.##....##\n###.##.##.\n.#....##.#\n#.#..#...#\n.....#.#..\n#.#..#..#.\n#.#..#....\n..........\n......##.#\n\nTile 1459:\n.###.##..#\n#.......#.\n##........\n..#...####\n###.......\n#....#....\n.#.....#.#\n###..#..##\n.....#....\n..#..#..##\n\nTile 2129:\n....#.#..#\n#.....##.#\n#........#\n..........\n..#......#\n#.....#..#\n.#..##...#\n#.#.#..#.#\n#.........\n#.##....##\n\nTile 1601:\n.#.#.#.#.#\n..#..##...\n#.#.#...#.\n....##....\n....##.#..\n..#.......\n#.....#..#\n#..##.#...\n.........#\n...####.#.\n\nTile 1801:\n#.#...#.#.\n..#....#..\n#..#...#..\n......#...\n.....#....\n#.#..##.##\n#.........\n...#.#...#\n.#....#..#\n#.....##..\n\nTile 2447:\n..#.....##\n.#..#...##\n.....#.#..\n.#....#..#\n#...####.#\n##.##..###\n.#.......#\n#.##.....#\n#.......##\n.###.#...#\n\nTile 2203:\n#.....##..\n#.#.......\n........##\n###...#...\n..........\n#..#.....#\n....#.##.#\n..##.....#\n.#...#...#\n#.###..#..\n\nTile 1381:\n.#...#...#\n....#.....\n##.......#\n#.....#...\n.........#\n.#.......#\n.......##.\n#.#.....##\n.#..#.##..\n##.#.##.#.\n\nTile 3163:\n#...####.#\n#......##.\n...###.#.#\n#....##...\n#......###\n.....#..##\n.#..###...\n#..##..#..\n#.....#...\n#.#####.##\n\nTile 3673:\n.#....##.#\n..#..####.\n#.....#...\n...#....#.\n#....#...#\n#....##.#.\n##...#.#..\n.#..#.#...\n#..#.....#\n####.##...\n\nTile 3919:\n....##.##.\n##..##....\n...##...##\n#...#.....\n..........\n....#..###\n.#.....#..\n....#..#.#\n.##..#....\n.#...###.#\n\nTile 2437:\n..##...#.#\n#....#...#\n#..#.....#\n..#.#...##\n.......#..\n........##\n........##\n.......#.#\n#....#.#.#\n##..#.###.\n\nTile 2969:\n##.#.##.#.\n#.##....#.\n.##......#\n#.#.#....#\n#.#.......\n.........#\n....#.#.##\n.#.......#\n...#..#.##\n##.#.##..#\n\nTile 2621:\n.##.##.#..\n.##...#...\n..........\n#.........\n#.#.#.#..#\n..#..#...#\n.......#.#\n#.#.....##\n...#..#...\n#.......##\n\nTile 3613:\n##..#....#\n#..##.....\n..#.......\n..#...#...\n...#...#..\n...#.....#\n..#.....#.\n..#.###..#\n..........\n..#.####..\n\nTile 2777:\n##.#####.#\n#.##.#...#\n..#.......\n.##...##.#\n.........#\n.#.###.##.\n#......##.\n#......##.\n#...##..##\n#..#....##\n\nTile 2711:\n#..#..##..\n..........\n#.#......#\n#.....####\n..........\n##.......#\n........#.\n#.......#.\n#.#..#...#\n#.#.####.#\n\nTile 2281:\n.#.###...#\n###....#..\n..........\n#.#..#..##\n.........#\n###..#.##.\n####..#..#\n##..#.....\n##..#..#..\n#.....#..#\n\nTile 1579:\n....#..#..\n#........#\n#...#..#..\n..##.#.#..\n.###.#...#\n....##..#.\n...##.#...\n.#.##....#\n.#.......#\n##...#...#\n\nTile 2411:\n#.#....##.\n..#...#..#\n.#..##....\n.#..##...#\n.....#.#.#\n......##..\n#.#....###\n.#.##....#\n..#..#....\n..#.###..#\n\nTile 2963:\n.......##.\n.....#....\n.........#\n#.....#..#\n.....#.#..\n.....#.##.\n.#.#...###\n#.#.......\n.#.......#\n###..#..#.\n\nTile 1693:\n#.##..##..\n..........\n.........#\n.##..#...#\n.........#\n#........#\n###......#\n..#...#...\n.#.##....#\n...#.#...#\n\nTile 2399:\n###.#.##..\n#...#.....\n...#...#.#\n###.......\n.##.##....\n##.....#.#\n####......\n##.......#\n#..#...#.#\n#...#.....\n\nTile 1913:\n##.....###\n........##\n#.....###.\n..........\n....#...#.\n#.#.....#.\n#....#...#\n..#...#...\n....#..#..\n#..####...\n\nTile 3343:\n.....#.##.\n..#...#...\n####.....#\n....#.....\n......#..#\n......#...\n#........#\n#.......#.\n..#...#.#.\n.....###.#\n\nTile 2557:\n#.......##\n....#...##\n#......#.#\n#.#.#.#.##\n#..##.....\n..###.#.#.\n#..#......\n#...#.....\n....#....#\n#.##...#.#\n\nTile 1097:\n.#.#.#..##\n..#.#.....\n##........\n.##...##..\n..#..#...#\n#........#\n........##\n#.#.#.....\n.#.#.....#\n#.##..#...\n\nTile 2591:\n##..#..###\n......#...\n...###.#..\n#.......#.\n#.#.....#.\n#.##..#...\n....##.#..\n#.#..#...#\n#.###..#.#\n##........\n\nTile 3413:\n...##...##\n..#....#..\n##.#....#.\n#..#....#.\n#........#\n#..#......\n#.....#.##\n##.....#.#\n#....#....\n####.#...#\n\nTile 2087:\n###..###.#\n##......#.\n#..#...#.#\n#.#.......\n##.#.....#\n#.#.#.....\n...#.....#\n..........\n#.........\n#.##..###.\n\nTile 3037:\n......##..\n..#..#....\n#.#.......\n#.#....#..\n.#.#.##..#\n#.....#.##\n#.....#.#.\n.#..##...#\n#....##...\n...#..###.\n\nTile 2239:\n.####..#..\n#.........\n.#.......#\n#..##.....\n##..##..##\n#.#....#..\n.........#\n#.......#.\n....#.....\n#.###..#.#\n\nTile 3313:\n##.##.#..#\n.#.#..#...\n.##...##.#\n.#.##..#..\n##........\n..........\n#..#.#....\n#.........\n..........\n.##..#..#.\n\nTile 3361:\n.###.#...#\n##..#.#..#\n...##....#\n#..##.....\n..........\n#......#.#\n.........#\n..#..##.#.\n#..#...###\n#...#.#.#.\n\nTile 3167:\n..##..####\n#.....#.#.\n.....#.#..\n...#......\n....#.#.##\n...#.#.#..\n.......#..\n##........\n#..#...#.#\n####.##..#\n\nTile 1979:\n#.#.###...\n..#.....##\n...#...##.\n#.......##\n........##\n..##..#...\n..#......#\n#.#....#.#\n#..#.....#\n.##.......\n\nTile 1831:\n##.##.##.#\n#.........\n.........#\n##.......#\n###.....##\n..##..##..\n##.....#.#\n#....#...#\n###.##..#.\n#..#####..\n\nTile 1487:\n#..#....##\n.#..#....#\n#....#....\n#.........\n#.#...#.##\n#..##...##\n...##..#..\n.#...##...\n.#........\n.#...#..#.\n\nTile 1987:\n###..#....\n##..##...#\n......#..#\n.#.#...#.#\n.....#.#..\n....#..#..\n....###..#\n#...##....\n###.....#.\n...##.####\n\nTile 3083:\n....##..#.\n##..#.###.\n#..#...##.\n#.###.....\n.........#\n....#.....\n.#........\n.#........\n#.........\n#.#.#.##.#\n\nTile 1543:\n...##..###\n.........#\n.......#.#\n#..#..#.##\n##....#.#.\n....#..#..\n#..#......\n...#...#.#\n##.##..#..\n#.###..#..\n\nTile 1151:\n#.#..#####\n#.#..#...#\n#..#......\n....#...#.\n..........\n#...#.#..#\n#..#.#...#\n##....#..#\n#.........\n##.....###\n\nTile 1009:\n##..#...##\n#....#...#\n.#...#....\n#........#\n.#..#..#..\n.###.##.#.\n#......#.#\n##.#..##..\n#....#.###\n####...##.\n\nTile 3929:\n......#.#.\n#..#.##.##\n....#.#.##\n#.##..#...\n###..#..#.\n.##..###.#\n.##......#\n....#....#\n........#.\n.#...###..\n\nTile 1321:\n#.##..#...\n.##.....##\n#.#..#....\n...#.....#\n###......#\n#.#.#.##.#\n##.......#\n##......#.\n.#...#....\n.#..##..##\n\nTile 2017:\n###.#..###\n.#..###..#\n#..#......\n.........#\n..#...##..\n....#.##.#\n...##.#..#\n....#...##\n#..#..##..\n##.#.#.#..\n\nTile 1747:\n....##.#..\n#........#\n.....#..#.\n..#####...\n######..#.\n##..#.#...\n.###..#..#\n#.....#...\n.##..#..##\n..#####...\n\nTile 3089:\n#....#.##.\n#.....#..#\n..........\n#..#.#....\n.......#..\n#.....#...\n........#.\n##..#..##.\n#.....#..#\n#.#.#....#\n\nTile 3019:\n.#..###.##\n.#...#...#\n#.#.......\n###.......\n#....#...#\n#.##...#..\n##........\n.#.......#\n.#.#......\n.#..#...#.\n\nTile 3079:\n...#.###..\n#......#..\n#.......##\n#...#..###\n#.......#.\n......#.#.\n#........#\n.#.#...###\n..#.#....#\n...#...#.#\n\nTile 1663:\n##.##..###\n#.....##.#\n......#.##\n#........#\n..#.#.....\n....#..#.#\n#.#.#..#.#\n#.......#.\n..#......#\n#.#..#....\n\nTile 1823:\n.###...###\n#.#.#..##.\n..........\n.........#\n###....#..\n..........\n##....#.##\n#.......##\n..#..#...#\n......####\n\nTile 3823:\n....#..#..\n..#.#..#.#\n###.#.##.#\n..##....#.\n#.........\n#....#...#\n#.......##\n#.#...##..\n..#....#..\n..#....##.\n\nTile 1901:\n#.#.#....#\n..#....#.#\n...#..#.#.\n.#..#..###\n....####..\n......#...\n#....#....\n..#....#..\n#......#..\n######.#..\n\nTile 3347:\n#.#.....#.\n#..#..#...\n#.#.......\n#..#.#....\n...#......\n#.........\n##.#.....#\n#........#\n#....#...#\n#.#.##.###\n\nTile 1873:\n..###.#.##\n.#.#....#.\n#........#\n..#..#...#\n##.....#..\n#........#\n#.........\n.#........\n#.#..#.#.#\n.##.#...##\n\nTile 2053:\n#.#.#.#..#\n#...###..#\n##.##.##.#\n....##.#.#\n#.###....#\n#.....#..#\n#..##.####\n....#..#..\n#.........\n#..#.#..#.\n\nTile 2659:\n.#....##.#\n#.#......#\n#..#......\n.#.###.#.#\n..........\n#........#\n.......#.#\n....#....#\n#........#\n##..##.#..\n\nTile 2503:\n.#..####.#\n#.##......\n..#....###\n..#..#.###\n...##...##\n..#.....#.\n..........\n##.#......\n#.#.......\n#...#..#.#\n\nTile 3881:\n##.###.###\n#......#..\n#...#....#\n..#.#....#\n#..#..#..#\n#..#.....#\n...#..##.#\n#.#.......\n#..##....#\n...#.##...\n\nTile 1973:\n..#.###.#.\n#.##....##\n#.......##\n##......##\n#.........\n#.#..#....\n.#....###.\n..#.#..#..\n......#..#\n#..#.....#\n\nTile 3329:\n.#.#.###.#\n..#.#.....\n.#.......#\n#..#.##.##\n#.##..####\n..#.##..##\n....#.....\n#...#.#.#.\n...#.#...#\n.#...##..#\n\nTile 3331:\n#......###\n#......#.#\n#.#.#.#..#\n........#.\n.##.####..\n#..#..#..#\n.#.......#\n......#.##\n......#.#.\n.##...#.#.\n\nTile 1307:\n##.#.#..#.\n.........#\n.#....##.#\n#.........\n#.........\n#....#.#..\n........##\n......##..\n..#.##...#\n..##...##.\n\nTile 2543:\n.#.#.##.##\n#........#\n..##......\n#.........\n##...#...#\n.###..##.#\n.##......#\n.#........\n.....#.#..\n...######.\n\nTile 2003:\n#.#..#.#.#\n.....#....\n#.#.#.....\n####.#..##\n..###....#\n....#.#...\n#.####...#\n.##...#.##\n#.#.#..#..\n...#.....#\n\nTile 3301:\n##....##.#\n.....#...#\n#........#\n..........\n###.##.#..\n.....#...#\n#.#......#\n....##...#\n#........#\n.#.#...#.#\n\nTile 2297:\n#..#.##..#\n...#.#.##.\n..###..#..\n##..#.....\n####..#..#\n..#.#..#..\n.....#...#\n#...#.....\n#.....#..#\n##....#...\n\nTile 2311:\n##.....#.#\n##........\n#........#\n#...##....\n#......#..\n.........#\n.........#\n#..#.#....\n.....#...#\n###.#..##.\n\nTile 1361:\n.#.##.#..#\n#.#..#...#\n#....###..\n..###.#...\n#..#.....#\n#..#...##.\n#.#.....#.\n.......#.#\n##.##.....\n#.###.#..#\n\nTile 1481:\n.####.#.##\n..........\n.........#\n###.#.#...\n##....##.#\n..#...#.##\n..##.#.#..\n#.#.....##\n.......#..\n....###...\n\nTile 1153:\n.##.##..##\n###......#\n#....##...\n......#.#.\n#....#....\n.....##..#\n.....#...#\n#.........\n#...#....#\n##..#.#...\n\nTile 2153:\n#.###.#..#\n..#.##....\n..##....#.\n##...#...#\n#...#.....\n........#.\n#..##...#.\n..#.......\n#...##.#..\n#.#.#.#...\n\nTile 2377:\n.##..##.#.\n...##..#.#\n#.#.#.....\n#.##......\n#.....#..#\n#...#....#\n...##....#\n...###....\n.#.##...##\n.###.##...\n\nTile 3863:\n.##.###.##\n.......#.#\n#........#\n##.#.#...#\n##...#...#\n#...##....\n#..#..#.##\n.....#####\n##.#..###.\n....###...\n\nTile 1163:\n##..######\n#........#\n.#.#...###\n..#..#...#\n##..#...##\n#.#.......\n#.#..#....\n#..#.#....\n###..#...#\n.#####.###\n\nTile 2207:\n.#..#.#.##\n##.....#.#\n#..#.....#\n#..#....##\n.........#\n...#.....#\n#...#..#..\n..#.....##\n.....#....\n#.##.....#\n\nTile 1201:\n#.##.##..#\n#.#.......\n#..#.....#\n.###...#..\n#.#......#\n........##\n.........#\n.##....#.#\n..##.#...#\n.......###\n\nTile 1619:\n#.....#.#.\n...#.##..#\n#.....#...\n#...#.....\n#..#...#.#\n#..##.#...\n.#...#.#..\n#......##.\n#.........\n#.##...###\n\nTile 3389:\n...#..##..\n#........#\n#...#.....\n#.#....#.#\n###....#.#\n#.#....###\n#..##..#.#\n.##.#.#..#\n#...###...\n#...#....#\n\nTile 3359:\n.###..##..\n#........#\n###...#.#.\n........##\n....#..#.#\n.#.#......\n#........#\n.......#.#\n.#.....#..\n##.###....\n")
